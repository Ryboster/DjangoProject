{% extends 'app1/pages/blank.html' %}
{% load custom_filters %}


{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'styles/blog/buttons.css' %}">
<link rel="stylesheet" href="{% static 'styles/blog/sidebar.css' %}">
<link rel="stylesheet" href="{% static 'styles/blog/overlay.css' %}">
<link rel="stylesheet" href="{% static 'styles/blog/textContent.css' %}">


<button class="Button" onclick="toggleDeletePostForm(this)">
    <img style="padding:0" src="{% static 'assets/icons/trash_icon1.svg' %}" >
</button>

<div id="deletePostForm" style="display:none">
    <form method="POST" action="{% url 'delete_post' %}">
        {% csrf_token %}
        
        <input type="hidden" name="ID" value="">
        <input type="hidden" name="table" value="">

        <button type="submit">Confirm</button>
    </form>
</div>
{% endblock styles %}


{% block textContent %}

    <div id="Title" style="display:inline-flex;">
        <h1 id="content" class="content">{{ Title|trim }}</h1>

        <div class="adminButtonsContainer">
            <button class="Button" onclick="OpenEditOverlay(this)">
                <img style="padding:0" src="{% static 'assets/icons/edit_icon.svg' %}" >
            </button>
            <button class="Button" onclick="toggleDeleteForm(this)">
                <img style="padding:0" src="{% static 'assets/icons/trash_icon1.svg' %}" >
            </button>
        </div>
    </div>

    
    <div id="Rating" style="display:inline-flex;">
        <h3 id="content" class="content">{{ Rating|trim }} / 5</h3>

        <div class="adminButtonsContainer">
            <button class="Button" onclick="OpenEditOverlay(this)">
                <img style="padding:0" src="{% static 'assets/icons/edit_icon.svg' %}" >
            </button>
            <button class="Button" onclick="toggleDeleteForm(this)">
                <img style="padding:0" src="{% static 'assets/icons/trash_icon1.svg' %}" >
            </button>
        </div>
    </div>


    <div style="display:flex; flex-direction:row; margin-left: auto;margin-right: auto;">
        <img onclick="selectImage(this)" src="{% static 'assets/furi.png' %}" id="secondaryContainer" style="max-width:300px; max-height:300px;"/>
        <img onclick="selectImage(this)" src="{% static 'assets/scattered_lands.png' %}" id="primaryContainer" style="max-width: 500px; max-height: 500px;"/> 
        <img onclick="selectImage(this)" src="{% static 'assets/ds1.png' %}" id="secondaryContainer" style="max-width:300px; max-height:300px;"/>
    </div>

    <p>{{ Pictures|trim }} <br></p>

        
    
    
    <div id="Paragraph" style="display:flex; justify-content: center;">
        <div id="content" class="content"> {{ Paragraph|trim }}</div>

        <div class="adminButtonsContainer">
            <button class="Button" onclick="OpenEditOverlay(this)">
                <img style="padding:0" src="{% static 'assets/icons/edit_icon.svg' %}" >
            </button>
            <button class="Button" onclick="toggleDeleteForm(this)">
                <img style="padding:0" src="{% static 'assets/icons/trash_icon1.svg' %}" >
            </button>
        </div>
    </div>


    

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {
        var textContainerTag = document.getElementsByClassName("textContainer")[0];
        textContainerTag.id = "{{ ID|escapejs }}";
    });
</script>


<script>

    function selectImage(image)
    {
        overlay = document.getElementById("imageOverlay");
        overlay.style.display = '';
        overlay.firstElementChild.src = image.src;
    }

    function OpenEditOverlay(button) {

        var form = document.getElementById('editFormOverlay');

        var table = "Blog";
        var column = button.closest("div").parentElement.id;
        var ID = "{{ ID|escapejs }}";
        var currentValue = button.closest("div").parentElement.querySelector("#content").textContent;


        if (column === "Paragraph") {
            form.querySelector('input[name="new_value"]').disabled = true;
            form.querySelector('input[name="new_value"]').style.display = "none";

            textarea = form.querySelector('textarea[name="new_value"]')

            
            textarea.style.display = '';
            textarea.style.resize = "none";
            textarea.style.width = '100%';
            textarea.style.minHeight = "200px";
            
            textarea.disabled = false;

            textarea.value = currentValue;
            textarea.style.height = '';
            textarea.style.height = textarea.scrollHeight + 'px';

        } else {
            form.querySelector('input[name="new_value"]').disabled = false;
            form.querySelector('input[name="new_value"]').style.display = "";
            
            form.querySelector('textarea[name="new_value"]').style.display = 'none';
            form.querySelector('textarea[name="new_value"]').disabled = true;

            form.querySelector('input[name="new_value"]').value = currentValue;
        }

        
        form.querySelector('input[name="table"]').value = table;
        form.querySelector('input[name="column"]').value = column;
        form.querySelector('input[name="ID"]').value = ID;
        

        if (form.style.display === 'none' || form.style.display === '') {
            form.style.display = '';
        }
    }


    function toggleDeleteForm(button) {
        var form = document.getElementById("deleteFormOverlay");

        var table = "Blog";
        var column = button.closest("div").parentElement.id;
        var ID = "{{ ID|escapejs }}";

        form.querySelector('input[name="table"]').value = table;
        form.querySelector('input[name="column"]').value = column;
        form.querySelector('input[name="ID"]').value = ID;

        if (form.style.display === 'none' || form.style.display === '') {
            form.style.display = '';
        } else {
            form.style.display = 'none';
        }
    }

    function toggleDeletePostForm(button) {
        var form = document.getElementById("deletePostForm");

        var table = "Blog";
        var ID = "{{ ID|escapejs }}";
        
        form.querySelector('input[name="ID"]').value = ID;
        form.querySelector('input[name="table"]').value = table;

        if (form.style.display === 'none' || form.style.display === '') {
            form.style.display = 'block';
        } else {
            form.style.display = 'none';
        }
    }

    function toggleCreateForm(button) {
        var form = document.getElementById("createForm");

        var table = "Blog"

        form.querySelector('input[name="table"]').value = table;
    
        if (form.style.display === 'none' || form.style.display === '') {
            form.style.display = 'block';
        } else {
            form.style.display = 'none';
        }
    }

</script>
        
<!-- Edit Form -->
<div id="editFormOverlay", class="overlay" style="display:none", onclick="this.style.display = 'none'">
    <div class="formContainer" onclick="event.stopPropagation();">
        <form  id="editForm" method="POST" action="{% url 'update' %}">
            {% csrf_token %}
            <input type="text" name="new_value" required style="margin-top:0;">
            <textarea oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'" type="text" name="new_value" disabled required style="display:none;"></textarea>

            <input type="hidden" name="ID" value="">
            <input type="hidden" name="table" value="">
            <input type="hidden" name="column" value="">

            <button type="submit">Confirm</button>
        </form>
    </div>
</div>


<!-- Truncate Content Form -->
<div id="deleteFormOverlay", class="overlay" style="display:none", onclick="this.style.display = 'none'">
    <div class="formContainer" onclick="event.stopPropagation();">
        <form id="deleteForm" method="POST" action="{% url 'delete' %}">
            {% csrf_token %}
            <input type="hidden" name="ID" value="">
            <input type="hidden" name="table" value="">
            <input type="hidden" name="column" value="">
        
            <button type="submit">Confirm</button>
        </form>
    </div>
</div>

<div id="imageOverlay" class="overlay" style="display:none" onclick="this.style.display = 'none'">

    <img src="" style="max-width: auto; max-height:auto; "/>
</div>


{{ text }}

{% endblock %}

{% block sidebarContent %}
    <div class="sidebarContainer">

        <h3 class="header">Content</h3>

        <h4 class="header"> Games </h4>
        <ul id="gamesList">
            {% for endpoint, title in EndpointPairs %}
            <li> <a href="/blog/{{ endpoint }}">{{ title }} </a></li>
            {% endfor %}

        </ul>

        <button onclick="toggleCreateForm(this)">
            +
        </button>


        <div id="createForm" style="display:none;">
            <form method="POST" action="{% url 'create' %}">
                {% csrf_token %}
                
                <input type="hidden" name="table" value="">

                <label for="ID">ID  </label>
                <input type="text" name="ID" value=""><br>
                
                <label for="title">Title    </label>
                <input type="text" name="title" value="">
        
                <button type="submit">Confirm</button>
            </form>
        </div>
    </div>

{% endblock %}